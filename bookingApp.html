<!DOCTYPE html>
<html>
    <head>

    </head>
    <body style="background: url('C:\Users\MANOJ\Desktop\minor project\overpopulated classroom') no-repeat;
    background-size: cover;">
        <div class="box" style="border: 1px; border-color: black; align-items: center;">
            <h5>Book a call</h5>
            <form action="#" onsubmit="saveToLocal(event)">
                <label for="name">Name</label><br>
                <input type="text" id="name" name="name" required><br><br>
                <label for="email">Email</label><br>
                <input type="email" id="email" name="email" required><br><br>
                <label for="phone">Phone</label><br>
                <input type="number" id="phone" maxlength="10" name="phone"><br><br>
                <label for="time">time for call</label><br>
                <input type="date" name="date">
                <input type="time" name="time"><br><br>
                <input type="submit" name="Get a call">

            </form>
            <ul id='listOfUser'></ul>
        </div>
        <script>
            /*
            function submission(event){
                event.preventDefault();
                console.log(event.target.name.value);
                console.log(event.target.email.value);
                console.log(event.target.phone.value);
                console.log(event.target.date.value);
                console.log(event.target.time.value);
            }
            */
           
           function submission(event){
               event.preventDefault();
               const name =event.target.name.value;
               const email = event.target.email.value;
               const phoneNo = event.target.phone.value;

               sessionStorage.setItem('name', name);
               sessionStorage.setItem('email', email);
               sessionStorage.setItem('phone', phoneNo);
           }
           
           /*
           function saveToSession(event){
                event.preventDefault();
               const Username = event.target.name.value;
               const UserEmail = event.target.email.value;
               const UserPhone = event.target.phone.value;
               const userDetail= {
                   'Name' : Username,
                   'Email' : UserEmail,
                   'Phone' : UserPhone
               };

               const stringOfObj = JSON.stringify(userDetail);
               localStorage.setItem('userdetail' , stringOfObj);
               const actualObj = JSON.parse(stringOfObj);
               console.log(JSON.parse(localStorage.getItem('userdetail')));
           }
           */
           // show user on refreshing the page
           addEventListener("DOMContentLoaded", ()=>{
            const localStorageObj = localStorage;
            const localStorageKeys = Object.keys(localStorageObj);
            
            for(let i =0; i<localStorageKeys.length; i++){
                const key = localStorageKeys[i];
                const userDetailString = localStorageObj[key];
                const userDetailObj = JSON.parse(userDetailString);
                showNewUser(userDetailObj);
            }
           })


           //store multiple user
           function saveToLocal(e){
               e.preventDefault();
               const name = e.target.name.value;
               const email = e.target.email.value;
               const phone = e.target.phone.value;

               const userDetail = {
                 'name' : name,
                 'email' : email,
                 phone
               };

               localStorage.setItem(email , JSON.stringify(userDetail));
               showNewUser(userDetail);
           }
           /*
           var form = document.getElementsByTagName('form');

           form.addEventListene('submit' , addUser);
            

           function addUser(e){
               e.preventDefault();
               var ul = document.createElement('ul');
               var li = document.createElement('li');
               var name = document.getElementById('name');
               var email = document.getElementById('email');
               li.appendChild(document.createTextNode(name).value);
               li.appendChild(document.createTextNode(email).value);
               ul.appendChild(li);
           }
           */

           //to show user detail on the screen
          function showNewUser(user){
                document.getElementById('email').value = '';
                document.getElementById('name').value = '';
                document.getElementById('phone').value ='';


              if(localStorage.getItem(user.email)!=null){
                  removeUser(user.email);
              }
              const parentNode = document.getElementById('listOfUser');
              const childNode = `<li id=${user.email}> ${user.name} - ${user.email}
                                <button onclick=editUser('${user.name}','${user.email}','${user.phone}')>Edit User</button>
                                <button onclick=deleteUser('${user.email}')>Delete User</button>
                                </li>`;

              parentNode.innerHTML = parentNode.innerHTML + childNode;
          }

          //to remove user from local storage
          function deleteUser(email){
              if(confirm(`Are You sure want to Delete User ${email}`)){
                  localStorage.removeItem(email);
                  removeUser(email);
              }
          }

          //to remove user detail from screen
          function removeUser(email){
              const parentNode = document.getElementById('listOfUser');
              const childNode = document.getElementById(email);
              if(childNode){
                  parentNode.removeChild(childNode);
              }
          }

          // to edit user detail
          function editUser(Username, email, phone){
              document.getElementById('name').value= Username;
              document.getElementById('email').value= email;
              document.getElementById('phone').value = phone;
              deleteUser(email);
          }

        </script>
    </body>
</html>